# API接口文档和测试说明

## 目录结构
```
agent/backend/API/
├── README.md                 # 本文档
├── assets_api.md            # 资产管理API接口文档
└── assets_api_test.py       # 资产管理API测试脚本
```

## 功能更新说明

### 新增"其他"设备类型支持
本次更新为资产管理系统新增了"其他"设备类型支持，允许用户添加不属于现有分类的设备。

**更新内容：**
- 后端模型：在 `AssetType` 枚举中添加 `OTHER = "other"`
- 前端界面：在添加/编辑资产弹窗的设备类型下拉框中添加"其他"选项
- 筛选功能：支持按"其他"类型筛选资产
- 显示优化：为"其他"类型设备设置紫色标签显示

### 删除K8S集群类型支持
为简化系统复杂度，已删除K8S集群设备类型：
- 从前端所有下拉框中移除"K8S集群"选项
- 从后端模型中删除 `K8S_CLUSTER` 枚举值
- 更新相关工具函数和显示逻辑

## 接口测试指南

### 环境准备
1. 确保后端服务运行在 `http://localhost:8000`
2. 安装Python依赖：
   ```bash
   pip install requests
   ```

### 运行测试
```bash
# 进入API目录
cd agent/backend/API

# 运行测试脚本
python assets_api_test.py
```

### 测试内容
测试脚本会自动执行以下测试：

1. **获取资产列表** - 验证API返回数据格式
2. **创建其他类型资产** - 测试新增的"其他"类型设备创建功能
3. **获取资产详情** - 验证单个资产信息获取
4. **更新资产信息** - 测试资产信息修改功能
5. **按类型筛选** - 验证各种设备类型筛选功能（Linux服务器、Windows服务器、网络设备、其他）
6. **删除测试资产** - 清理测试数据

### 测试输出示例
```
============================================================
资产管理API接口测试
============================================================
测试目标: http://localhost:8000/api
测试时间: 2023-12-01 15:30:00
============================================================

[15:30:01] 获取资产列表: ✓ 通过
    返回 8 个资产

[15:30:02] 创建其他类型资产: ✓ 通过
    创建成功，ID: 16, 类型: other

[15:30:03] 获取资产详情: ✓ 通过
    获取成功，设备: 测试其他设备_1701417002, 类型: other

[15:30:04] 更新其他类型资产: ✓ 通过
    更新成功，新名称: 更新后的其他设备_1701417004

[15:30:05] 按其他类型筛选: ✓ 通过
    筛选到 1 个其他类型设备
    linux_server: 0 个设备
    windows_server: 0 个设备
    network_device: 7 个设备

[15:30:06] 删除测试资产: ✓ 通过
    删除成功: 资产删除成功

============================================================
测试完成
============================================================
```

## 手动测试说明

### 前端界面测试
1. 访问资产管理页面
2. 点击"添加资产"按钮
3. 在"设备类型"下拉框中选择"其他"
4. 填写其他必要信息并提交
5. 验证资产列表中显示新创建的"其他"类型设备（紫色标签）

### API测试工具
推荐使用 Postman 或 curl 进行手动API测试：

```bash
# 创建其他类型设备
curl -X POST http://localhost:8000/api/assets \
  -H "Content-Type: application/json" \
  -d '{
    "name": "手动测试设备",
    "asset_type": "other",
    "ip_address": "192.168.1.100",
    "location": "测试机房",
    "security_level": "中高防护级别"
  }'

# 按类型筛选
curl "http://localhost:8000/api/assets?asset_type=other"
```

## 注意事项
- 测试脚本会创建和删除测试数据，请在测试环境中运行
- 确保IP地址不与现有资产冲突
- 如需修改测试目标地址，请编辑脚本中的 `BASE_URL` 变量 