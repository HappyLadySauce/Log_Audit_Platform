# 综合日志审计分析平台 - 重构与增强需求规格说明书

## 1. 引言

### 1.1. 目的

本文件旨在详细定义综合日志审计分析平台的重构与功能增强需求。本文档将作为项目开发、测试和验收的主要依据，旨在指导外部开发团队将现有演示原型（Proof of Concept）构建成一个功能完整、性能稳定、安全可靠的生产级系统。

### 1.2. 项目背景

项目源于一个已实现核心演示流程的日志审计平台原型。该原型采用前后端分离架构（Vue.js + FastAPI），验证了资产管理、模拟告警等关键功能。现计划在此基础上进行全面重构和功能完善，以满足企业对安全审计、合规性、威胁检测和应急响应的实际业务需求。

### 1.3. 范围

本项目范围涵盖对现有平台的后端重构、前端优化以及多项核心功能的深度实现和新增。关键范围包括：

- **功能深化**：将日志采集、告警引擎、AI 分析等模块从前端模拟转变为后端驱动的完整功能。
- **架构增强**：优化现有后端架构，确保系统的高性能、高可用性和可扩展性。
- **新增模块**：引入用户角色与权限管理 (RBAC)、可定制化报表等生产级功能。
- **技术栈**：建议延续并优化现有技术栈（Python/FastAPI, Vue.js），数据库从 `SQLite` 升级为生产级数据库（如 `PostgreSQL` 或 `MySQL`）。

### 1.4. 读者对象

本文档主要面向以下读者：

- **项目经理**：用于理解项目目标与范围，制定开发计划。
- **系统架构师与开发工程师**：作为系统设计与编码实现的详细指引。
- **测试与质量保证工程师**：作为编写测试用例和进行系统验收的标准。
- **产品与业务分析师**：用于确认系统是否满足业务需求。

---

## 2. 总体描述

### 2.1. 产品愿景

打造一个集中的、智能的安全日志审计与分析平台。该平台能够统一采集、管理和分析来自不同 IT 资产（服务器、网络设备、云原生环境等）的日志数据，通过强大的告警引擎和智能分析能力，帮助企业实时发现安全威胁、简化合规审计、提升应急响应效率。

### 2.2. 产品功能摘要

平台应具备以下核心功能模块：

- **统一资产管理**：全面管理和盘点组织内的所有 IT 资产及其安全属性。
- **多源日志采集**：实时、可靠地从多样化的数据源采集日志。
- **日志处理与检索**：对日志进行范式化、索引，并提供高效的查询与分析能力。
- **实时监控与告警**：基于灵活的规则引擎，实现对安全事件的实时告警。
- **可视化与报告**：通过仪表盘和报表直观展示系统安全态势。
- **智能分析**：利用 AI/ML 技术进行异常检测和威胁狩猎。
- **系统与用户管理**：提供细粒度的权限控制和系统配置功能。

### 2.3. 用户特征

- **安全管理员/分析师**：负责日常安全监控、告警处理、威胁分析和事件响应。
- **系统/网络管理员**：负责资产纳管、日志接入配置和系统自身运维。
- **审计员 (内部/外部)**：负责合规性检查，需要查询和导出日志与报告。
- **IT 主管/CISO**：关注整体安全态势、风险报告和系统投资回报。

### 2.4. 主要约束与假设

- **技术栈约束**：为保证开发效率和技术延续性，建议后端继续使用 FastAPI 框架，前端使用 Vue.js 框架。
- **性能基线**：系统应能支持至少 10,000 EPS (Events Per Second) 的日志接收能力和秒级的查询响应。
- **部署环境**：系统应设计为容器化部署（Docker/Kubernetes），以实现快速交付和弹性伸缩。
- **数据存储**：日志数据为高价值信息，需确保其存储的完整性、机密性和不可否认性。

---

## 3. 系统功能需求

### 3.1. 统一资产管理

此模块负责对所有 IT 资产进行统一纳管，是日志关联分析和风险评估的基础。需在现有原型基础上深化功能。

- **需求 3.1.1: 全面的资产信息**

  - 系统应支持管理包括但不限于 `Linux服务器`, `Windows服务器`, `网络设备` 等多种资产类型。
  - 资产信息应包含**基础信息**和**扩展安全信息**两个维度，覆盖 `功能更新.md` 中定义的所有字段（如设备型号、管理员、合规状态等）。
  - 支持完整的 `CRUD` (创建、读取、更新、删除) 操作，所有操作需通过后端 API 持久化。

- **需求 3.1.2: 资产状态与统计**

  - 资产应有明确的状态标识（如 `正常`, `异常`, `离线`），该状态应由后端根据监控数据（如心跳、告警）动态更新。
  - 仪表盘顶部的资产统计卡片（总资产、在线、异常、离线）需根据后端实时数据动态计算。

- **需求 3.1.3: 资产自动发现 (新增)**
  - 系统应提供网络扫描功能，能够自动发现指定网段内的存活主机和开放端口，并提示用户将其添加为受管资产。

### 3.2. 多源日志采集

**此模块需要从前端模拟转变为完整的后端实现。**

- **需求 3.2.1: 日志采集方式**

  - 采集方式无特殊要求，只要能采集就行。
  - **服务器**：提供轻量级 Agent (如 `Fluentd`, `Filebeat`) 用于采集 `Linux` 和 `Windows` 服务器的系统日志、应用日志和操作日志。
  - **网络设备**：支持通过标准 `SNMP` 协议接收来自交换机、防火墙等设备的日志。
  - **Kubernetes 集群**：支持通过上传 Kubeconfig 等操作实现采集集群事件、Pod 日志等。

- **需求 3.2.2: 采集状态监控**
  - 在前端界面上，必须能实时展示每个日志源的采集状态（如 `连接中`, `采集中`, `中断`），状态由后端实时推送或前端轮询获取。
  - 对于采集终端的服务器或集群，应能下钻查看详细的日志流。

### 3.3. 日志处理与存储

- **需求 3.3.1: 高效存储与检索**
  - 使用 `Elasticsearch` 或类似技术作为日志存储和检索引擎。
  - 提供强大的日志检索功能，支持全文搜索、字段精确/模糊匹配、逻辑组合（AND/OR/NOT）、时间范围筛选等。
  - 查询性能要求：1天的日志数据，应在 2 秒内返回结果。

### 3.4. 实时监控与告警

**此模块需要从前端模拟和硬编码规则，重构为灵活、动态的告警引擎。**

- **需求 3.4.1: 可视化规则引擎(可选)**

  - 用户应能通过 UI 界面创建、编辑、启用/禁用告警规则，无需修改后端代码。
  - **规则触发条件**：应支持基于 A) **关键词/字段匹配**、B) **聚合统计**（如：`5分钟内，同一IP地址登录失败次数 > 10次`）、C) **连续事件**（如：`连续5分钟未收到某设备心跳日志`）等多种条件。
  - 用户可自定义规则名称、描述、告警等级（`提示`, `警告`, `严重`, `紧急`）和触发频率。

- **需求 3.4.2: 告警生命周期管理**

  - 告警记录应有清晰的生命周期状态：`待处理`, `处理中`, `已处理`, `已归档`。
  - 支持对告警进行认领、处理、备注和归档操作，所有操作记录在案，形成完整的处理闭环，满足 `功能更新.md` 中描述的处置流程。

- **需求 3.4.3: 多渠道通知 (新增)**

  - 告警触发后，系统应支持通过多种渠道发送通知，包括：平台内通知、电子邮件、Webhook。

### 3.5. AI 智能分析

**此模块需要从前端模拟转变为完整的后端实现。**

- **需求 3.5.1: 异常行为检测**

  - 利用机器学习算法（如 `Isolation Forest`, `LTSM`）对用户登录、网络流量、资源访问等行为进行建模，自动检测与基线不符的异常活动。

- **需求 3.5.2: 威胁情报集成 (新增)**

  - 支持集成外部威胁情报库，自动关联分析日志中的 IP、域名、文件哈希等，发现已知威胁。

- **需求 3.5.3: 智能安全报告**
  - 系统应能自动生成周期性（每日/每周/每月）的安全态势分析报告。报告应图文并茂，包含安全评分、威胁趋势、主要发现和处置建议等内容，替代原有的静态模拟报告。

### 3.6. 可视化仪表盘

- **需求 3.6.1: 可定制仪表盘 (新增)**
  - 提供一个可定制的仪表盘，用户可以通过拖拽方式添加、移除和排列各种数据看板（Widget）。
  - 内置丰富的 Widget 库，如图表（线图、饼图、柱状图）、统计数值、地图等，用于展示日志量趋势、告警分布、资产状态等关键指标。

### 3.7. 用户与权限管理 (新增)

- **需求 3.7.1: 基于角色的访问控制 (RBAC)**
  - 系统必须支持多用户和基于角色的访问控制。
  - 内置预设角色（如 `管理员`, `安全分析师`, `审计员`），并支持自定义角色。
  - 权限控制应细化到功能模块的访问权（`可见/不可见`）和操作权（如 `增删改`）。

### 外部集成

- **通知**：如 3.4.3 所述，通过 Webhook 与外部机房报警灯集成。
- **工单系统 (可选)**：提供 API 将告警事件推送到外部 ITSM/工单系统（如 `Jira`, `ServiceNow`）。
